<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="https://libaco.org/blog/rss.xml" title="Libaco Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="https://libaco.org/blog/atom.xml" title="Libaco Blog Atom Feed"><title data-react-helmet="true">Build and test | Libaco</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Build and test | Libaco"><meta data-react-helmet="true" name="description" content="Build library"><meta data-react-helmet="true" property="og:description" content="Build library"><meta data-react-helmet="true" property="og:url" content="https://libaco.orghttps://libaco.org/docs/build-and-test"><link data-react-helmet="true" rel="shortcut icon" href="https://libaco.org/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://libaco.orghttps://libaco.org/docs/build-and-test"><link rel="stylesheet" href="https://libaco.org/styles.3751d533.css">
<link rel="preload" href="https://libaco.org/styles.6dbbae18.js" as="script">
<link rel="preload" href="https://libaco.org/runtime~main.1b7fdd23.js" as="script">
<link rel="preload" href="https://libaco.org/main.0e59d631.js" as="script">
<link rel="preload" href="https://libaco.org/1.c40176d6.js" as="script">
<link rel="preload" href="https://libaco.org/17.ab430a67.js" as="script">
<link rel="preload" href="https://libaco.org/19.c9d47d84.js" as="script">
<link rel="preload" href="https://libaco.org/935f2afb.342755c7.js" as="script">
<link rel="preload" href="https://libaco.org/16.0ad8f537.js" as="script">
<link rel="preload" href="https://libaco.org/058766fa.850d90dc.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a href="https://libaco.org/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><strong class="navbar__title">libaco</strong></a><a href="https://libaco.org/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Documentation</a><a href="https://libaco.org/support" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Support</a><a href="https://github.com/hnes/libaco" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a href="https://libaco.org/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><strong class="navbar__title">libaco</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://libaco.org/docs" target="_blank" rel="noopener noreferrer" class="menu__link">Documentation</a></li><li class="menu__list-item"><a href="https://libaco.org/support" target="_blank" rel="noopener noreferrer" class="menu__link">Support</a></li><li class="menu__list-item"><a href="https://github.com/hnes/libaco" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Getting started</a><ul class="menu__list"><li class="menu__list-item"><a href="https://libaco.org/docs/" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="0">Introduction</a></li><li class="menu__list-item"><a href="https://libaco.org/docs/description" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="0">Description</a></li><li class="menu__list-item"><a href="https://libaco.org/docs/build-and-test" target="_blank" rel="noreferrer noopener" class="menu__link menu__link--active" tabindex="0">Build and test</a></li><li class="menu__list-item"><a href="https://libaco.org/docs/tutorials" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="0">Tutorials</a></li></ul></li><li class="menu__list-item"><a href="https://libaco.org/docs/api" target="_blank" rel="noreferrer noopener" class="menu__link">API</a></li><li class="menu__list-item"><a href="https://libaco.org/docs/best-practice" target="_blank" rel="noreferrer noopener" class="menu__link">Best practice</a></li><li class="menu__list-item"><a href="https://libaco.org/docs/changelog" target="_blank" rel="noreferrer noopener" class="menu__link">Changelog</a></li><li class="menu__list-item"><a href="https://libaco.org/docs/benchmark" target="_blank" rel="noreferrer noopener" class="menu__link">Benchmark</a></li><li class="menu__list-item"><a href="https://libaco.org/docs/proof-of-correctness" target="_blank" rel="noreferrer noopener" class="menu__link">Proof of Correctness</a></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Build and test</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="build-library"></a>Build library<a class="hash-link" href="#build-library" title="Direct link to heading">#</a></h2><p><em><strong>Note</strong>: Please use <a href="https://github.com/hnes/libaco/releases" target="_blank" rel="noopener noreferrer">releases</a> instead of the <code>master</code> branch to build the final binary.</em></p><p>Libaco is meant to be copied into to your project and therefore no build tools is available to create a shared or static library.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="test"></a>Test<a class="hash-link" href="#test" title="Direct link to heading">#</a></h2><p>Want to make sure that the library is working on your system? We got you covered. Follow the steps below.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="build"></a>Build<a class="hash-link" href="#build" title="Direct link to heading">#</a></h3><p>To build the test suites of libaco</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">mkdir</span><span class="token plain"> output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">bash</span><span class="token plain"> make.sh</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>There is also some detailed options in make.sh. Read more about the <a href="#build-flags">build flags here.</a></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">$bash</span><span class="token plain"> make.sh -h</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Usage: make.sh </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">-o </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">no-m32</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">no-valgrind</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">-h</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Example:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># default build</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">bash</span><span class="token plain"> make.sh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># build without the i386 binary output</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">bash</span><span class="token plain"> make.sh -o no-m32</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># build without the valgrind supported binary output</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">bash</span><span class="token plain"> make.sh -o no-valgrind</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># build without the valgrind supported and i386 binary output</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">bash</span><span class="token plain"> make.sh -o no-valgrind -o no-m32</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>In short, using <code>-o no-valgrind </code> if you have no valgrind headers installed, <code>-o no-m32</code> if you have no 32-bit gcc development tools installed on a AMD64 host.</p><p>On MacOS, you need to <a href="https://apple.stackexchange.com/questions/69223/how-to-replace-mac-os-x-utilities-with-gnu-core-utilities" target="_blank" rel="noopener noreferrer">replace</a> the default <code>sed</code> and <code>grep</code> commands of MacOS with the GNU <code>sed</code> and <code>grep</code> to run <code>make.sh</code> and <code>test.sh</code> (such requirement would be removed in the future):</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ brew </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> --with-default-names</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ brew </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> gnu-sed --with-default-names</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="run-tests"></a>Run tests<a class="hash-link" href="#run-tests" title="Direct link to heading">#</a></h3><p>To run the tests, simply run the following.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">bash</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">/test.sh</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="build-flags"></a>Build flags<a class="hash-link" href="#build-flags" title="Direct link to heading">#</a></h2><p>The <code>-m32</code> option of gcc could help you to build the i386 application of libaco on a x86_64 machine.</p><ul><li>C macro: <code>ACO_CONFIG_SHARE_FPU_MXCSR_ENV</code></li></ul><p>You could define the global C macro <code>ACO_CONFIG_SHARE_FPU_MXCSR_ENV</code> to speed up the performance of context switching between coroutines slightly if none of your code would change the control words of FPU and MXCSR. If the macro is not defined, all the co would maintain its own copy of the FPU and MXCSR control words. It is recommended to always define this macro globally since it is very rare that one function needs to set its own special env of FPU or MXCSR instead of using the default env defined by the ISO C. But you may not need to define this macro if you are not sure of it.</p><ul><li>C macro:<code>ACO_USE_VALGRIND</code></li></ul><p>If you want to use the tool memcheck of valgrind to test the application, then you may need to define the global C macro <code>ACO_USE_VALGRIND</code> to enable the friendly support of valgrind in libaco. But it is not recommended to define this macro in the final release build for the performance reason. You may also need to install the valgrind headers (package name is &quot;valgrind-devel&quot; in centos for example) to build libaco application with C macro <code>ACO_USE_VALGRIND</code> defined. (The memcheck of valgrind only works well with the standalone co currently. In the case of the shared stack used by more than one non-main co, the memcheck of valgrind would generate many false positive reports. For more information you may refer to <a href="https://github.com/hnes/libaco/blob/master/test_aco_tutorial_6.c" target="_blank" rel="noopener noreferrer">test_aco_tutorial_6.c</a>.</p><ul><li>C macro:<code>ACO_USE_ASAN</code></li></ul><p>The global C macro <code>ACO_USE_ASAN</code> would enable the friendly support of <a href="https://en.wikipedia.org/wiki/AddressSanitizer" target="_blank" rel="noopener noreferrer">Address Sanitizer</a> in libaco (support both gcc and clang).</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/libaco/libaco.github.io/edit/master/docs/build-and-test.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a href="https://libaco.org/docs/description" target="_blank" rel="noopener noreferrer" class="pagination-nav__link"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Description</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a href="https://libaco.org/docs/tutorials" target="_blank" rel="noopener noreferrer" class="pagination-nav__link"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Tutorials Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#build-library" class="table-of-contents__link">Build library</a></li><li><a href="#test" class="table-of-contents__link">Test</a><ul><li><a href="#build" class="table-of-contents__link">Build</a></li><li><a href="#run-tests" class="table-of-contents__link">Run tests</a></li></ul></li><li><a href="#build-flags" class="table-of-contents__link">Build flags</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 <a href="https://github.com/libaco/" target="_blank">libaco</a>. Built with Docusaurus.</div></div></div></footer></div>
<script src="https://libaco.org/styles.6dbbae18.js"></script>
<script src="https://libaco.org/runtime~main.1b7fdd23.js"></script>
<script src="https://libaco.org/main.0e59d631.js"></script>
<script src="https://libaco.org/1.c40176d6.js"></script>
<script src="https://libaco.org/17.ab430a67.js"></script>
<script src="https://libaco.org/19.c9d47d84.js"></script>
<script src="https://libaco.org/935f2afb.342755c7.js"></script>
<script src="https://libaco.org/16.0ad8f537.js"></script>
<script src="https://libaco.org/058766fa.850d90dc.js"></script>
</body>
</html>