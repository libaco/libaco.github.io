<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Libaco Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Libaco Blog Atom Feed"><title data-react-helmet="true">API | Libaco</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="API | Libaco"><meta data-react-helmet="true" name="description" content="Introduction"><meta data-react-helmet="true" property="og:description" content="Introduction"><meta data-react-helmet="true" property="og:url" content="https://libaco.org/docs/api"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://libaco.org/docs/api"><link rel="stylesheet" href="/styles.3751d533.css">
<link rel="preload" href="/styles.6dbbae18.js" as="script">
<link rel="preload" href="/runtime~main.638f6b7e.js" as="script">
<link rel="preload" href="/main.bea35c64.js" as="script">
<link rel="preload" href="/1.c40176d6.js" as="script">
<link rel="preload" href="/17.ab430a67.js" as="script">
<link rel="preload" href="/19.c9d47d84.js" as="script">
<link rel="preload" href="/935f2afb.6fe096db.js" as="script">
<link rel="preload" href="/16.0ad8f537.js" as="script">
<link rel="preload" href="/5fbc5cf1.2588bef6.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><strong class="navbar__title">libaco</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Documentation</a><a class="navbar__item navbar__link" href="/support">Support</a><a href="https://github.com/hnes/libaco" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><strong class="navbar__title">libaco</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs">Documentation</a></li><li class="menu__list-item"><a class="menu__link" href="/support">Support</a></li><li class="menu__list-item"><a href="https://github.com/hnes/libaco" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/description">Description</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/build-and-test">Build and test</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials">Tutorials</a></li></ul></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/docs/api">API</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/best-practice">Best practice</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/changelog">Changelog</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/benchmark">Benchmark</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/proof-of-correctness">Proof of Correctness</a></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">API</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p>It would be very helpful to read the corresponding API implementation in the source code simultaneously when you are reading the following API description of libaco since the source code is pretty clear and easy to understand. And it is also recommended to read all the <a href="/docs/tutorials">tutorials</a> before reading the API document.</p><p>It is strongly recommended to read the <a href="/docs/best-practice">best practice</a> part before starting to write the real application of libaco (in addition to describing how to truly release libaco&#x27;s extreme performance in your application, there is also a notice about the programming of libaco).</p><p>Note: The version control of libaco follows the spec: <a href="https://semver.org/spec/v2.0.0.html" target="_blank" rel="noopener noreferrer">Semantic Versioning 2.0.0</a>. So the API in the following list have the compatibility guarantee. (Please note that there is no such guarantee for the API no in the list.)</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="functions"></a>Functions<a class="hash-link" href="#functions" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="aco_thread_init"></a>aco_thread_init<a class="hash-link" href="#aco_thread_init" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-c codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">typedef</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">aco_cofuncp_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">aco_thread_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">aco_cofuncp_t last_word_co_fp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Initializes the libaco environment in the current thread.</p><p>It will store the current control words of FPU and MXCSR into a thread-local global variable.</p><ul><li>If the global macro <code>ACO_CONFIG_SHARE_FPU_MXCSR_ENV</code> is not defined, the saved control words would be used as a reference value to set up the control words of the new co&#x27;s FPU and MXCSR (in <code>aco_create</code>) and each co would maintain its own copy of FPU and MXCSR control words during later context switching.</li><li>If the global macro <code>ACO_CONFIG_SHARE_FPU_MXCSR_ENV</code> is defined, then all the co shares the same control words of FPU and MXCSR. You may refer the <a href="/docs/build-and-test">build and test</a> part of this document for more information about this.</li></ul><p>And as it said in the <code>test_aco_tutorial_5.c</code> of the <a href="/docs/tutorials">tutorials</a> part, when the 1st argument <code>last_word_co_fp</code> is not NULL then the function pointed by <code>last_word_co_fp</code> will substitute the default protector to do some &quot;last words&quot; stuff about the offending co before the process is aborted. In such last word function, you could use <code>aco_get_co</code> to get the pointer of the offending co. For more information, you may read <code>test_aco_tutorial_5.c</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="aco_share_stack_new"></a>aco_share_stack_new<a class="hash-link" href="#aco_share_stack_new" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-c codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">aco_share_stack_t</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">aco_share_stack_new</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">size_t sz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Equal to <code>aco_share_stack_new2(sz, 1)</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="aco_share_stack_new2"></a>aco_share_stack_new2<a class="hash-link" href="#aco_share_stack_new2" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-c codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">aco_share_stack_t</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">aco_share_stack_new2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">size_t sz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> guard_page_enabled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Creates a new share stack with a advisory memory size of <code>sz</code> in bytes and may have a guard page (read-only) for the detection of stack overflow which is depending on the 2nd argument <code>guard_page_enabled</code>.</p><p>To use the default size value (2MB) if the 1st argument <code>sz</code> equals 0. After some computation of alignment and reserve, this function will ensure the final valid length of the share stack in return:</p><ul><li><code>final_valid_sz &gt;= 4096</code></li><li><code>final_valid_sz &gt;= sz</code></li><li><code>final_valid_sz % page_size == 0 if the guard_page_enabled != 0</code></li></ul><p>And as close to the value of <code>sz</code> as possible.</p><p>When the value of the 2nd argument <code>guard_page_enabled</code> is 1, the share stack in return would have one read-only guard page for the detection of stack overflow while a value 0 of <code>guard_page_enabled</code> means without such guard page.</p><p>This function will always return a valid share stack.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="aco_share_stack_destroy"></a>aco_share_stack_destroy<a class="hash-link" href="#aco_share_stack_destroy" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-c codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">aco_share_stack_destroy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">aco_share_stack_t</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> sstk</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Destory the share stack <code>sstk</code>.</p><p>Be sure that all the co whose share stack is <code>sstk</code> is already destroyed when you destroy the <code>sstk</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="aco_create"></a>aco_create<a class="hash-link" href="#aco_create" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-c codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">typedef</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">aco_cofuncp_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">aco_t</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">aco_create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">aco_t</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> main_coï¼Œaco_share_stack_t</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> share_stack</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        size_t save_stack_sz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> aco_cofuncp_t co_fp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> arg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Create a new co.</p><p>If it is a main_co you want to create, just call: <code>aco_create(NULL, NULL, 0, NULL, NULL)</code>. Main co is a special standalone coroutine whose share stack is the default thread stack. In the thread, main co is the coroutine who should be created and started to execute before all the other non-main coroutine does.</p><p>Otherwise it is a non-main co you want to create:</p><ul><li>The 1st argument <code>main_co</code> is the main co the co will <code>aco_yield</code> to in the future context switching. <code>main_co</code> must not be NULL;</li><li>The 2nd argument <code>share_stack</code> is the address of a share stack which the non-main co you want to create will use as its executing stack in the future. <code>share_stack</code> must not be NULL;</li><li>The 3rd argument <code>save_stack_sz</code> specifies the init size of the private save stack of this co. The unit is in bytes. A value of 0 means to use the default size 64 bytes. Since automatical resizing would happen when the private save stack is not big enough to hold the executing stack of the co when it has to yield the share stack it is occupying to another co, you usually should not worry about the value of <code>sz</code> at all. But it will bring some performance impact to the memory allocator when a huge amount (say 10,000,000) of the co resizes their private save stack continuously, so it is very wise and highly recommended to set the <code>save_stack_sz</code> with a value equal to the maximum value of <code>co-&gt;save_stack.max_cpsz</code> when the co is running (You may refer to the <a href="/docs/best-practice">best practice</a> part of this document for more information about such optimization);</li><li>The 4th argument <code>co_fp</code> is the entry function pointer of the co. <code>co_fp</code> must not be NULL;</li><li>The last argument <code>arg</code> is a pointer value and will set to <code>co-&gt;arg</code> of the co to create. It could be used as a input argument for the co.</li></ul><p>This function will always return a valid co. And we name the state of the co in return as &quot;init&quot; if it is a non-main co you want to create.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="aco_resume"></a>aco_resume<a class="hash-link" href="#aco_resume" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-c codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">aco_resume</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">aco_t</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> co</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Yield from the caller main co and to start or continue the execution of <code>co</code>.</p><p>The caller of this function must be a main co and must be <code>co-&gt;main_co</code>. And the 1st argument <code>co</code> must be a non-main co.</p><p>The first time you resume a <code>co</code>, it starts running the function pointing by <code>co-&gt;fp</code>. If <code>co</code> has already been yielded, <code>aco_resume</code> restarts it and continues the execution.</p><p>After the call of <code>aco_resume</code>, we name the state of the caller â€” main co as &quot;yielded&quot;.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="aco_yield"></a>aco_yield<a class="hash-link" href="#aco_yield" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-c codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">aco_yield</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Yield the execution of <code>co</code> and resume <code>co-&gt;main_co</code>. The caller of this function must be a non-main co. And <code>co-&gt;main_co</code> must not be NULL.</p><p>After the call of <code>aco_yield</code>, we name the state of the caller â€” <code>co</code> as &quot;yielded&quot;.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="aco_get_co"></a>aco_get_co<a class="hash-link" href="#aco_get_co" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-c codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">aco_t</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">aco_get_co</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Return the pointer of the current non-main co. The caller of this function must be a non-main co.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="aco_get_arg"></a>aco_get_arg<a class="hash-link" href="#aco_get_arg" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-c codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">aco_get_arg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Equal to <code>(aco_get_co()-&gt;arg)</code>. And also, the caller of this function must be a non-main co.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="aco_exit"></a>aco_exit<a class="hash-link" href="#aco_exit" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-c codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">aco_exit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>In addition do the same as <code>aco_yield()</code>, <code>aco_exit()</code> also set <code>co-&gt;is_end</code> to 1 thus to mark the <code>co</code> at the status of &quot;end&quot;.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="aco_destroy"></a>aco_destroy<a class="hash-link" href="#aco_destroy" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-c codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">aco_destroy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">aco_t</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> co</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Destroy the <code>co</code>. The argument <code>co</code> must not be NULL. The private save stack would also been destroyed if the <code>co</code> is a non-main co.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="macros"></a>Macros<a class="hash-link" href="#macros" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="version"></a>Version<a class="hash-link" href="#version" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-c codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> ACO_VERSION_MAJOR 1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> ACO_VERSION_MINOR 2</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> ACO_VERSION_PATCH 4</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>These 3 macros are defined in the header <code>aco.h</code> and the value of them follows the spec: <a href="https://semver.org/spec/v2.0.0.html" target="_blank" rel="noopener noreferrer">Semantic Versioning 2.0.0</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="aco_assert_overrideh"></a>aco_assert_override.h<a class="hash-link" href="#aco_assert_overrideh" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-c codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// provide the compiler with branch prediction information</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> likely(x)               aco_likely(x)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> unlikely(x)             aco_unlikely(x)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// override the default `assert` for convenience when coding</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> assert(EX)              aco_assert(EX)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// equal to `assert((ptr) != NULL)`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> assertptr(ptr)          aco_assertptr(ptr)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// assert the successful return of memory allocation</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> assertalloc_bool(b)     aco_assertalloc_bool(b)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> assertalloc_ptr(ptr)    aco_assertalloc_ptr(ptr)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>You could choose to include the header <code>&quot;aco_assert_override.h&quot;</code> to override the default C <a href="http://man7.org/linux/man-pages/man3/assert.3.html" target="_blank" rel="noopener noreferrer">assert</a> in the libaco application like <a href="https://github.com/hnes/libaco/blob/master/test_aco_synopsis.c" target="_blank" rel="noopener noreferrer">test_aco_synopsis.c</a> does (this header including should be at the last of the include directives list in the source file because the C <a href="http://man7.org/linux/man-pages/man3/assert.3.html" target="_blank" rel="noopener noreferrer">assert</a> is a C macro definition too) and define the 5 other macros in the above. Please do not include this header in the application source file if you want to use the default C <a href="http://man7.org/linux/man-pages/man3/assert.3.html" target="_blank" rel="noopener noreferrer">assert</a>.</p><p>For more details you may refer to the source file <a href="https://github.com/hnes/libaco/blob/master/aco_assert_override.h" target="_blank" rel="noopener noreferrer">aco_assert_override.h</a>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/libaco/libaco.github.io/edit/main/docs/api.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/tutorials"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Tutorials</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/best-practice"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Best practice Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link">Introduction</a></li><li><a href="#functions" class="table-of-contents__link">Functions</a><ul><li><a href="#aco_thread_init" class="table-of-contents__link">aco_thread_init</a></li><li><a href="#aco_share_stack_new" class="table-of-contents__link">aco_share_stack_new</a></li><li><a href="#aco_share_stack_new2" class="table-of-contents__link">aco_share_stack_new2</a></li><li><a href="#aco_share_stack_destroy" class="table-of-contents__link">aco_share_stack_destroy</a></li><li><a href="#aco_create" class="table-of-contents__link">aco_create</a></li><li><a href="#aco_resume" class="table-of-contents__link">aco_resume</a></li><li><a href="#aco_yield" class="table-of-contents__link">aco_yield</a></li><li><a href="#aco_get_co" class="table-of-contents__link">aco_get_co</a></li><li><a href="#aco_get_arg" class="table-of-contents__link">aco_get_arg</a></li><li><a href="#aco_exit" class="table-of-contents__link">aco_exit</a></li><li><a href="#aco_destroy" class="table-of-contents__link">aco_destroy</a></li></ul></li><li><a href="#macros" class="table-of-contents__link">Macros</a><ul><li><a href="#version" class="table-of-contents__link">Version</a></li><li><a href="#aco_assert_overrideh" class="table-of-contents__link">aco_assert_override.h</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 <a href="https://github.com/libaco/" target="_blank">libaco</a>. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.6dbbae18.js"></script>
<script src="/runtime~main.638f6b7e.js"></script>
<script src="/main.bea35c64.js"></script>
<script src="/1.c40176d6.js"></script>
<script src="/17.ab430a67.js"></script>
<script src="/19.c9d47d84.js"></script>
<script src="/935f2afb.6fe096db.js"></script>
<script src="/16.0ad8f537.js"></script>
<script src="/5fbc5cf1.2588bef6.js"></script>
</body>
</html>